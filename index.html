<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>手机GPS定位实验</title>

<!-- 引入 Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
    background-color: #f0f0f0;
  }
  #location {
    margin-top: 20px;
    font-size: 18px;
    color: #333;
  }
  #map {
    height: 400px;
    margin-top: 20px;
  }
  button {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #4caf50;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background-color: #45a049;
  }
</style>
</head>
<body>

<h1>手机GPS定位实验</h1>
<p>点击下方按钮以获取你手机的当前位置（需授权）。</p>
<button onclick="getLocation()">获取我的位置</button>
<div id="location">位置信息将显示在这里</div>
<div id="map"></div>

<!-- 引入 Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  let map;  // Leaflet 地图实例
  let marker; // 标记实例

  function getLocation() {
    const locationDiv = document.getElementById('location');
    if (!navigator.geolocation) {
      locationDiv.innerText = '错误：你的浏览器不支持定位功能。';
      return;
    }

    locationDiv.innerText = '正在获取位置...';

    navigator.geolocation.getCurrentPosition(
      (position) => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        locationDiv.innerText = `纬度: ${lat.toFixed(6)}, 经度: ${lng.toFixed(6)}`;

        // 如果地图不存在，创建地图并设置视图
        if (!map) {
          map = L.map('map').setView([lat, lng], 13);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap',
            maxZoom: 19,
          }).addTo(map);
        } else {
          map.setView([lat, lng], 13);
        }

        // 如果标记不存在，创建标记；否则更新标记位置
        if (!marker) {
          marker = L.marker([lat, lng]).addTo(map).bindPopup('你的位置').openPopup();
        } else {
          marker.setLatLng([lat, lng]).openPopup();
        }

        console.log(`位置数据 - 纬度: ${lat}, 经度: ${lng}`);
      },
      (error) => {
        switch(error.code) {
          case error.PERMISSION_DENIED:
            locationDiv.innerText = '错误：用户拒绝了定位请求。';
            break;
          case error.POSITION_UNAVAILABLE:
            locationDiv.innerText = '错误：位置信息不可用。';
            break;
          case error.TIMEOUT:
            locationDiv.innerText = '错误：请求超时。';
            break;
          default:
            locationDiv.innerText = '错误：未知错误。';
        }
      }
    );
  }
</script>
</body>
</html>
